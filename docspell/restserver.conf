docspell.server.bind {
  address = 0.0.0.0
  port = 7880
}
docspell.server.base-url = "https://docs.xeno.darksair.org"
docspell.joex.bind {
  address = localhost
  port = 7878
}

docspell.server.backend {
  jdbc {
    url = "jdbc:h2:///var/lib/docspell/docspell.db;MODE=PostgreSQL;DATABASE_TO_LOWER=TRUE;AUTO_SERVER=TRUE"
  }

  files {
    default-store = "database"
    stores = {
      database = {
        enabled = true
        type = "default-database"
      }
    }
  }

  signup {
    # The mode defines if new users can signup or not. It can have
    # three values:
    #
    # - open: every new user can sign up
    # - invite: new users can sign up only if they provide a correct
    #   invitation key. Invitation keys can be generated by the
    #   server.
    # - closed: signing up is disabled.
    mode = "closed"
  }

}

docspell.server.openid =
    [ { enabled = true,
        # The name to render on the login link/button.
        display = "Keycloak"

        # This illustrates to use a custom keycloak setup as the
        # authentication provider. For details, please refer to the
        # keycloak documentation. The settings here assume a certain
        # configuration at keycloak.
        #
        # Keycloak can be configured to return the collective name for
        # each user in the access token. It may also be configured to
        # return it in the user info response. If it is already in the
        # access token, an additional request can be omitted. Set the
        # `sign-key` to an empty string then. Otherwise provide the
        # algo and key from your realm settings. In this example, the
        # realm is called "home".
        provider = {
          provider-id = "keycloak",
          client-id = "docspell",
          client-secret = "{{ client_secret }}",
          scope = "openid profile", # scope is required for OIDC
          authorize-url = "https://auth.xeno.darksair.org/realms/xeno/protocol/openid-connect/auth",
          token-url = "https://auth.xeno.darksair.org/realms/xeno/protocol/openid-connect/token",
          #User URL is not used when signature key is set.
          user-url = "https://auth.xeno.darksair.org/realms/xeno/protocol/openid-connect/userinfo",
          logout-url = "https://auth.xeno.darksair.org/realms/xeno/protocol/openid-connect/logout"
          sign-key = ""
          sig-algo = "RS256"
        },
        # The collective of the user is given in the access token as
        # property `docspell_collective`.
        collective-key = "lookup:docspell_collective",
        # The username to use for the docspell account
        user-key = "preferred_username"
      }
    ]

oidc-auto-redirect = true
